<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        function generateMineMap() {
            const width = $('#width').val();
            const height = $('#height').val();
            const mineCount = $('#mineCount').val();

            if(mineCount === '' || width === '' || height === '') {
                alert('ê°€ë¡œê¸¸ì´, ì„¸ë¡œê¸¸ì´, ì§€ë¢° ê°¯ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if(mineCount >= width * height) {
                alert('ì§€ë¢° ê°¯ìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤.');
                return;
            }

            $.ajax({
                url: '/makeMineMap',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    n: width,
                    m: height,
                    mineCount: mineCount
                }),
                success: function (data) {
                    // console.log(data);
                    createGrid(width, height);
                }
            });
        }

        function createGrid(width, height) {
            const gridContainer = $('#gridContainer');
            gridContainer.empty(); // ê¸°ì¡´ ê·¸ë¦¬ë“œ ì œê±°

            for(let i = 0; i < height; i++) {
                const row = $('<div>').addClass('row');

                for(let j = 0; j < width; j++) {
                    const cell = $('<button>').addClass('cell').text(' ')
                        .on('click', function() {
                        // ì¢Œí´ë¦­ ì´ë²¤íŠ¸
                        // alert(`Cell (${i}, ${j}) clicked`);
                        openCell(i, j);
                    })
                        .on('contextmenu', function(e) {
                            // ìš°í´ë¦­ ì´ë²¤íŠ¸
                            e.preventDefault(); // ìš°í´ë¦­ ì°½ ë„ì›€ ë°©ì§€
                            markCell(i, j);
                        });
                    row.append(cell);
                }

                gridContainer.append(row);
            }
        }

        function openCell(i, j) {
            // alert(`Cell (${i}, ${j}) left clicked`); // í™•ì¸

            // ì„œë²„ì— í•´ë‹¹ ì…€ ì—´ê¸° ìš”ì²­
            $.ajax({
                url: '/openCell',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    x: i,
                    y: j
                }),
                success: function (data) {
                    // console.log(data);
                    if(data === 'mine') {
                        alert('Game Over');
                        showAllMines(); // ëª¨ë“  ì§€ë¢° í‘œì‹œ
                        $(".cell").off("click"); // ëª¨ë“  ì…€ í´ë¦­ ì´ë²¤íŠ¸ ì œê±°
                        $(".cell").off("contextmenu"); // ëª¨ë“  ì…€ ìš°í´ë¦­ ì´ë²¤íŠ¸ ì œê±°
                    } else {
                        const cell = $(`.row:eq(${i}) .cell:eq(${j})`);
                        cell.text(data);
                    }
                }
            });

            // const cell = $(`.row:eq(${i}) .cell:eq(${j})`);
            // cell.text('O');
        }

        function markCell(i, j) {
            // alert(`Cell (${i}, ${j}) right clicked`); // í™•ì¸
            const cell = $(`.row:eq(${i}) .cell:eq(${j})`);
            if(cell.text() === 'ğŸš©') {
                cell.text(' ');
            } else {
                cell.text('ğŸš©');
            }
        }

        function showAllMines() {
            $.ajax({
                url: '/getAllMines',
                type: 'GET',
                contentType: 'application/json',
                success: function (data) {
                    for (let i = 0; i < data.length; i++) {
                        const x = data[i].x;
                        const y = data[i].y;
                        const cell = $(`.row:eq(${x}) .cell:eq(${y})`);
                        cell.text('ğŸš©');
                    }
                }
            });
        }

    </script>

    <style>
        .row {
            margin: 0; /*ì—¬ë°± ì œê±°*/
            display: flex; /* row ë‚´ì˜ ìš”ì†Œë“¤ì„ flexboxë¡œ ë§Œë“­ë‹ˆë‹¤. */
            /*align-items: stretch; !* row ë‚´ì˜ ìš”ì†Œë“¤ì´ ì„¸ë¡œë¡œ ê½‰ ì°¨ê²Œ ë§Œë“­ë‹ˆë‹¤. *!*/
        }
        .cell {
            width: 20px;  /* ì…€ì˜ ê°€ë¡œ í¬ê¸° ì„¤ì • */
            height: 20px; /* ì…€ì˜ ì„¸ë¡œ í¬ê¸° ì„¤ì • */
            padding: 0;   /* ì…€ ë‚´ë¶€ì˜ ì—¬ë°± ì œê±° */
            margin: 0;    /* ì…€ ì£¼ë³€ì˜ ì—¬ë°± ì œê±° */
            /*border: none; !* ì…€ì˜ í…Œë‘ë¦¬ ì œê±° *!*/
            border: 1px solid black; /* ì…€ì˜ í…Œë‘ë¦¬ ì„¤ì • */
        }
    </style>

</head>
<body>
    <h1>ëˆŒëŸ¬ëˆŒëŸ¬ ë¹µë¹µ</h1>
    <p>
        <label for="width">ê°€ë¡œê¸¸ì´</label>
        <input type="text" id="width" name="width" value="10">
        <br>
        <label for="height">ì„¸ë¡œê¸¸ì´</label>
        <input type="text" id="height" name="height" value="10">
        <br>
        <label for="mineCount">ì§€ë¢° ê°¯ìˆ˜</label>
        <input type="text" id="mineCount" name="mineCount" value="30">
        <br>
        <button onclick="generateMineMap()">ì§€ë¢° ë§µ ìƒì„±í•˜ê¸°</button>
    </p>

    <div id="gridContainer"></div>



</body>
</html>